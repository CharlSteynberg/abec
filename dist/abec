#! /usr/bin/node


// cond :: validate : dependencies
try
{
    require("abec");
}
catch(err)
{
    if((err+"").indexOf("Cannot find module"))
    {
        err=`\nmissing dependencies .. run this command in the cloned project folder:\n`
           +` npm install\n\n-then try again\n\nIf this error persists, `
           +`make sure:\n - npm is installed\n - the project has a "package.json" file\n`;
    };

    console.log(err);
    process.exit(1);
};


defn
({
    handle:
    {
        CLI:
        {
            host: function host()
            {
                server.create.apply(server,args(arguments));
            },

            durl: function durl(src,dst)
            {
                let rsl = endurl(src);
                disk.writeFile(dst,rsl);
                dump(OK);
            },
        },
    }
});



(function init(a,c)
{
    config.Host.eventLog = true;
    config.Host.readDirs = true;
    // config.View.backDrop = ""; // TODO :: this could be messy, but worth it .. to be developed
    // config.Host.showHidn = true;

    a=args();  if(!expect.word(a[0])){return};
    c=a.shift(); if(!handle.CLI[c]){moan(`invalid option "${c}"`); return};

    dump("running: abec "+c);

    when("allReady").then(()=>
    {
        handle.CLI[c].apply(handle.CLI,a);
    });
}());
